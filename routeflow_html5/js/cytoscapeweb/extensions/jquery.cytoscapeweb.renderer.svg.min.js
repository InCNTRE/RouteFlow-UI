
/* jquery.cytoscapeweb.renderer.svg.min.js */

/**
 * This file is part of Cytoscape Web snapshot-2012.03.27-15.39.21.
 * 
 * Cytoscape Web is free software: you can redistribute it and/or modify it
 * under the terms of the GNU Lesser General Public License as published by the Free
 * Software Foundation, either version 3 of the License, or (at your option) any
 * later version.
 * 
 * Cytoscape Web is distributed in the hope that it will be useful, but WITHOUT
 * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS
 * FOR A PARTICULAR PURPOSE. See the GNU Lesser General Public License for more
 * details.
 * 
 * You should have received a copy of the GNU Lesser General Public License along with
 * Cytoscape Web. If not, see <http://www.gnu.org/licenses/>.
 */
 
(function(i,l){var k={minZoom:0.001,maxZoom:1000,maxPan:-1>>>1,minPan:(-(-1>>>1)-1),selectionToPanDelay:500,style:{selectors:{node:{fillColor:"#888",fillOpacity:1,borderColor:"#666",borderOpacity:1,opacity:1,borderWidth:0,borderStyle:"solid",height:10,width:10,shape:"ellipse",cursor:"pointer",visibility:"visible",labelValign:"top",labelHalign:"middle",labelText:{defaultValue:"",passthroughMapper:"label"},labelFillColor:"#000",labelOutlineColor:"#666",labelOutlineWidth:0,labelFontSize:"inherit",labelFontStyle:"normal",labelFontDecoration:"none",labelFontVariant:"italic",labelFontFamily:"Arial",labelFontWeight:"bold",labelOpacity:1,labelOutlineOpacity:1},edge:{lineColor:"#ccc",targetArrowColor:"#ccc",sourceArrowColor:"#ccc",targetArrowShape:"none",sourceArrowShape:"none",opacity:1,width:1,style:"solid",cursor:"pointer",visibility:"visible",labelText:{defaultValue:"",passthroughMapper:"label"},labelFillColor:"#000",labelOutlineColor:"#666",labelOutlineWidth:0,labelFontSize:"inherit",labelFontStyle:"normal",labelFontDecoration:"none",labelFontVariant:"italic",labelFontFamily:"Arial",labelFontWeight:"bold",labelOutlineOpacity:1,labelOpacity:1}},global:{panCursor:"grabbing",selectionFillColor:"#ccc",selectionOpacity:0.5,selectionBorderColor:"#888",selectionBorderWidth:1}}};
var s={};var d=function(t){i.cytoscapeweb("renderer","svg","linestyle",t.name,t);delete t.name};d({name:"solid",array:undefined});d({name:"dot",array:[1,5]});d({name:"longdash",array:[10,2]});d({name:"dash",array:[5,5]});var o=function(t){i.cytoscapeweb("renderer","svg","edgearrowshape",t.name,t);delete t.name};o({name:"triangle",svg:function(u,w,x,t,v){return u.polygon(w,[[0,1],[0.5,0],[1,1]])},centerPoint:{x:0.5,y:0.5}});o({name:"square",svg:function(u,w,x,t,v){return u.polygon(w,[[0,0],[0,1],[1,1],[1,0]])
},centerPoint:{x:0.5,y:0.5}});o({name:"circle",svg:function(u,w,x,t,v){return u.circle(w,0.5,0.5,0.5)},centerPoint:{x:0.5,y:0.5}});var m=function(t){i.cytoscapeweb("renderer","svg","nodeshape",t.name,t);delete t.name};m({name:"ellipse",svg:function(u,w,x,t,v){return u.ellipse(w,t.x,t.y,v.width,v.height)},update:function(u,w,x,t,v){u.change(x.renderer("svg"),{cx:t.x,cy:t.y,rx:v.width/2,ry:v.height/2})},intersectionShape:Ellipse});m({name:"rectangle",svg:function(u,w,x,t,v){return u.rect(w,t.x-v.width/2,t.y-v.height/2,v.width,v.height)
},update:function(u,w,x,t,v){u.change(x.renderer("svg"),{x:t.x-v.width/2,y:t.y-v.height/2,width:v.width,height:v.height})},intersectionShape:Rectangle});m({name:"roundrectangle",svg:function(u,w,x,t,v){return u.rect(w,t.x-v.width/2,t.y-v.height/2,v.width,v.height,v.width/4,v.height/4)},update:function(u,w,x,t,v){u.change(x.renderer("svg"),{x:t.x-v.width/2,y:t.y-v.height/2,width:v.width,height:v.height})},intersectionShape:Rectangle});m({name:"triangle",svg:function(u,w,x,t,v){return u.polygon(w,[[t.x,t.y-v.height/2],[t.x+v.width/2,t.y+v.height/2],[t.x-v.width/2,t.y+v.height/2]])
},update:function(u,w,x,t,v){u.change(x.renderer("svg"),{points:[[t.x,t.y-v.height/2],[t.x+v.width/2,t.y+v.height/2],[t.x-v.width/2,t.y+v.height/2]]})},intersectionShape:Polygon});function q(t){if(t!=null&&typeof t==typeof""&&(t=="hidden"||t=="visible")){return t}else{l.console.error("SVG renderer does not recognise %o as a valid visibility",t)}}function b(t){if(t!=null&&typeof t==typeof 1&&!isNaN(t)&&0<=t&&t<=1){return t}else{l.console.error("SVG renderer does not recognise %o as a valid percent (should be between 0 and 1)",t)
}}function p(t){if(t!=null&&typeof t==typeof""&&i.Color(t)!=""){return i.Color(t).toHEX()}else{l.console.error("SVG renderer does not recognise %o as a valid colour",t)}}function c(t){if(t!=null&&typeof t==typeof 1&&!isNaN(t)){return t}else{l.console.error("SVG renderer does not recognise %o as a valid number",t)}}function n(u){var t=i.cytoscapeweb("renderer","svg","nodeshape",u);if(t==null){l.console.error("SVG renderer does not recognise %s as a valid node shape",u)}return t}function e(u){var t=i.cytoscapeweb("renderer","svg","linestyle",u);
if(t==null){l.console.error("SVG renderer does not recognise %s as a valid line style",u)}return t}function j(t){if(t=="none"||t==null){return null}return i.cytoscapeweb("renderer","svg","edgearrowshape",t)}function r(t){if(t!=null&&typeof t==typeof""&&(t=="left"||t=="right"||t=="middle")){return t}else{l.console.error("SVG renderer does not recognise %o as a valid label horizonal alignment",t)}}function g(t){if(t!=null&&typeof t==typeof""&&(t=="top"||t=="bottom"||t=="middle")){return t}else{l.console.error("SVG renderer does not recognise %o as a valid label vertical alignment",t)
}}function h(t){if(t=="grab"){if(i.browser.webkit){return"-webkit-grab"}else{if(i.browser.mozilla){return"-moz-grab"}else{return"move"}}}else{if(t=="grabbing"){if(i.browser.webkit){return"-webkit-grabbing"}else{if(i.browser.mozilla){return"-moz-grabbing"}else{return"move"}}}else{return t}}}function f(t){l.console.debug("Creating SVG renderer with options (%o)",t);this.options=i.extend({},k,t);this.setStyle(t.style);this.cy=t.cy;l.console.debug("SVG renderer is using style (%o)",this.style)}f.prototype.init=function(w){var v=this;
this.cy=this.options.cy;var t=this.cy.container();var u=t.svg("get");this.container=t;this.svg=u;if(u!=null){t.svg("destroy")}t.css({padding:"0 !important"});t.svg({onLoad:function(x){if(v.scale==null){v.scale=1}if(v.translation==0){v.translation={x:0,y:0}}t.find("svg").css("overflow","hidden");u=x;v.svg=u;v.svg.change();v.svgBg=u.rect(0,0,"100%","100%",{fill:"white",opacity:0});v.edgesGroup=u.group();v.nodesGroup=u.group();v.svgRoot=i(v.nodesGroup).parents("svg:first")[0];v.selectedElements=v.cy.collection();
v.touchingNodes=v.cy.collection();v.defs=v.svg.defs();v.makeBackgroundInteractive();w()},settings:{height:"100%",width:"100%"}})};f.prototype.offsetFix=function(u){var t=this;if(u.offsetX==null||u.offsetY==null){u.offsetX=u.clientX-t.cy.container().offset().left;u.offsetY=u.clientY-t.cy.container().offset().top}};f.prototype.makeBackgroundInteractive=function(){var C=this;var L=C.svgRoot;var N=C.options.selectionToPanDelay;C.shiftDown=false;i(window).bind("keydown keyup",function(Q){C.shiftDown=Q.shiftKey
});function u(Q){return Q.target==L||i(Q.target).parents("g:last")[0]==C.edgesGroup||i(Q.target)[0]==C.svgBg}i(L).bind("mousedown",function(S){if(S.button!=0){return}if(u(S)){S.preventDefault();C.offsetFix(S);var T=null;var R={};var U=false;var W=true;var ab=S.pageX;var Z=S.pageY;var Q=S.offsetX;var ad=S.offsetY;var ac=0;var aa=0;var V=setTimeout(function(){if(!C.cy.panning()){return}U=true;W=false;C.svg.change(L,{cursor:h(C.style.global.panCursor)});C.cy.container().scrollLeft(100)},N);var X=function(aj){clearTimeout(V);
var ah=aj.pageX-ab;var ag=aj.pageY-Z;ab=aj.pageX;Z=aj.pageY;ac+=ah;aa+=ag;if(U){C.translation.x+=ah;C.translation.y+=ag;C.pan(C.translation)}if(W){if(T==null){T=C.svg.rect(Q,ad,0,0,{fill:p(C.style.global.selectionFillColor),opacity:b(C.style.global.selectionOpacity),stroke:p(C.style.global.selectionBorderColor),strokeWidth:c(C.style.global.selectionBorderWidth)})}else{var ai=Math.abs(ac);var af=Math.abs(aa);var ae=ac>=0?Q:Q+ac;var ak=aa>=0?ad:ad+aa;R={x1:ae,y1:ak,x2:ae+ai,y2:ak+af};C.svg.change(T,{x:ae,y:ak,width:ai,height:af})
}}};i(window).bind("mousemove",X);var Y=function(ae){if(ae.type=="mouseup"&&ae.button!=0){return}clearTimeout(V);i(window).unbind("mousemove",X);i(window).unbind("mouseup",Y);i(window).unbind("blur",Y);i(L).unbind("mouseup",Y);if(U){C.svg.change(L,{cursor:null})}if(W){if(T!=null&&R.x1!=null&&!isNaN(R.x1)){C.selectElementsFromIntersection(T,R);C.svgRemove(T)}else{if(!C.shiftDown){C.unselectAll()}}}};i(window).bind("mouseup",Y);i(window).bind("blur",Y);i(L).bind("mouseup",Y)}}).bind("mousewheel",function(V,W,S,R){if(!C.cy.panning()||!C.cy.zooming()){return
}C.offsetFix(V.originalEvent);var Q={x:V.originalEvent.offsetX,y:V.originalEvent.offsetY};var T=0.5;if(i.browser.mozilla||i.browser.msie){T=0.167}var U=C.zoom()*(1+R*T);C.zoomAboutPoint(Q,U);C.cy.trigger("zoom");C.cy.trigger("pan");V.preventDefault()});function G(T,R){var Q,W;var U=C.cy.container().offset();var S=T.originalEvent.touches;var V=S[R];Q=V.pageX-U.left;W=V.pageY-U.top;return{x:Q,y:W}}function H(R){var S=G(R,0);var Q=G(R,1);return{x:(S.x+Q.x)/2,y:(S.y+Q.y)/2}}function x(R){var S=G(R,0);
var Q=G(R,1);return C.getDistance(S,Q)}function M(Q){return Q.originalEvent.touches==null?0:Q.originalEvent.touches.length}function w(Q,R){return M(Q)>=R}function K(Q){if(Q>=2){O=true;t=true;clearTimeout(v);v=setTimeout(function(){t=false},E)}else{O=false}}var E=100;var O=false;var t=false;var v=null;var I=true;var P,y,D,A,z,J,F,B;i(L).bind("touchstart",function(Q){if(!u(Q)||C.touchingNodes.size()>0){return}Q.preventDefault();A=G(Q,0);if(w(Q,2)){P=H(Q);y=C.modelPoint(P);D=x(Q);z=G(Q,1);K(2)}else{K(1);
I=true}B=false}).bind("touchmove",function(R){if(!u(R)||C.touchingNodes.size()>0){return}I=false;if(w(R,2)){K(2);F=G(R,1)}else{K(1)}R.preventDefault();var X={x:0,y:0};if(w(R,1)&&C.cy.panning()){J=G(R,0);if(w(R,2)&&C.cy.zooming()){var Q=x(R);var S=Q/D;P=C.renderedPoint(y);if(S!=1){var W=1.5;var V={x:J.x-A.x,y:J.y-A.y};var U={x:F.x-z.x,y:F.y-z.y};X={x:(V.x+U.x)/2,y:(V.y+U.y)/2};if(S>1){S=(S-1)*W+1}else{S=1-(1-S)*W}var T=C.zoom()*S;C.zoomAboutPoint(P,T,X);D=Q}}else{if(!t){X={x:J.x-A.x,y:J.y-A.y};C.panBy(X)
}}A=J;z=F}}).bind("touchend",function(Q){if(I&&u(Q)){C.unselectAll()}});i(L).bind("mousedown mouseup click mouseover mouseout mousemove touchstart touchmove touchend",function(R){if(u(R)){var Q=i.extend({},R,{cyTarget:C.cy});C.cy.background().trigger(Q);C.cy.trigger(Q)}})};f.prototype.zoomAboutPoint=function(z,A,t){var B=this;var u=B.cy;if(!u.panning()||!u.zooming()){return}var w=B.pan();var y=B.zoom();var x=A;if(t==null){t={x:0,y:0}}var v={x:-x/y*(z.x-w.x-t.x)+z.x,y:-x/y*(z.y-w.y-t.y)+z.y};B.transform({translation:v,scale:x})
};f.prototype.zoom=function(v){var w=this.cy;if(!w.zooming()){return}if(v===undefined){return this.scale}else{if(typeof v==typeof{}){var u=v;var t=u.position;if(u.renderedPosition!==undefined){t=this.modelPoint(u.renderedPosition)}if(t!==undefined){this.zoomAboutPoint(t,v.level)}else{this.transform({scale:u.level})}}else{this.transform({scale:v})}}};f.prototype.fit=function(C){var t=C.elements;var L=C.zoom;var B=this.cy;if(!B.panning()||(L!==undefined&&!B.zooming())){return}if(t==null||t.size()==0){t=this.cy.elements()
}if(t.is(":removed")){l.console.debug("SVG renderer does not take into account removed elements when fitting");t=t.filter(":inside")}l.console.debug("Fit SVG renderer to view bounds");var y=this.nodesGroup.getBBox();var F=this.edgesGroup.getBBox();var x,I,u,H;function D(O){var N=O.x;var z=N+O.width;var M=O.y;var w=M+O.height;if(N<x||x==null){x=N}if(z>u||u==null){u=z}if(M<I||I==null){I=M}if(w>H||H==null){H=w}}t.nodes().each(function(){var w=this.renderer("svgGroup").getBBox();D(w)});t.edges().each(function(){var z=this.source().id();
var M=this.target().id();var w=this.renderer("svg").getBBox();if(z==M){if(w.x==F.x){x=Math.min(w.x+w.width*0.4,y.x)}if(w.y==F.y){I=Math.min(w.y+w.height*0.4,y.y)}}else{w=this.renderer("svgGroup").getBBox();D(w)}});var J=u-x;var E=H-I;var v=this.cy.container().width();var K=this.cy.container().height();var A=Math.min(v/J,K/E);if(L){this.transform({translation:{x:-x*A-(J*A-v)/2,y:-I*A-(E*A-K)/2},scale:A})}else{var G=this.scale;this.transform({translation:{x:-x*G+v/2-(u-x)/2*G,y:-I*G+K/2-(H-I)/2*G}})
}};f.prototype.panBy=function(t){if(!this.cy.panning()){return}l.console.debug("Relatively pan SVG renderer with position (%o)",t);this.transform({translation:{x:this.translation.x+c(t.x),y:this.translation.y+c(t.y)}})};f.prototype.pan=function(t){if(!this.cy.panning()){return}l.console.debug("Pan SVG renderer with position (%o)",t);if(t===undefined){return{x:this.translation.x,y:this.translation.y}}if(t==null||typeof t!=typeof{}){l.console.error("You can not pan without specifying a proper position object; `%o` is invalid",t);
return}this.transform({translation:{x:c(t.x),y:c(t.y)}})};f.prototype.capTransformation=function(y){var t=y.translation;var x=y.scale;var B=this;var u=B.options.maxZoom;var w=B.options.minZoom;var A=B.options.minPan;var v=B.options.maxPan;var z=true;var C=true;if(t!=null){if(t.x<A){t.x=A;C=false}else{if(t.x>v){t.x=v;C=false}}if(t.y<A){t.y=A;C=false}else{if(t.y>v){t.y=v;C=false}}}else{t=B.translation}if(x!=null){if(x>u){x=u;z=false}else{if(x<w){x=w;z=false}}}else{x=B.scale}return{scale:x,translation:t,valid:z&&C,validScale:z,validTranslation:C}
};f.prototype.transform=function(w){var u=this;var t=u.capTransformation(w);if(t.valid){u.translation=t.translation;u.scale=t.scale}else{if(w.capScale){l.console.debug("Capping zoom level %o to %o",u.scale,t.scale);u.scale=t.scale}if(w.capTranslation){l.console.debug("Capping translation %o to %o",u.translation,t.translation);u.translation=t.translation}}function v(x){if(u.svg==null||x==null){return}u.svg.change(x,{transform:"translate("+u.translation.x+","+u.translation.y+") scale("+u.scale+")"})
}v(u.nodesGroup);v(u.edgesGroup)};f.prototype.calculateStyleField=function(v,z){var t=this;var x=t.options.styleCalculator;var u=t.style.selectors;var w=undefined;var y=v.bypass(false)[z];if(y!==undefined){w=y}else{i.each(u,function(A,B){var C=B[z];if(C!=null&&v.is(A)){w=C}})}return x.calculate(v,w)};f.prototype.calculateStyle=function(w){var t=this;var A=t.options.styleCalculator;var v=t.style.selectors;var x={};i.each(v,function(B,C){if(w.is(B)){x=i.extend(x,C)}});x=i.extend(x,w.bypass(false));
i.each(x,function(B,C){x[B]=A.calculate(w,C)});w._private.style=x;if(w.isEdge()){var y=w.source();var z=w.target();function u(){if(y.style("visibility")=="visible"&&z.style("visibility")=="visible"){return q(x.visibility)}else{return"hidden"}}x.visibility=u()}return x};f.prototype.svgRemove=function(t){var u=i(t);var w=i(this.svgRoot);function v(y){var z=i(y);var x=false;if(z.parent().size()==0){return false}z.parents().each(function(){if(this==w[0]){x=true}});return x}if(t==null||!v(t)){return}this.svg.remove(t)
};f.prototype.updateNodePositionFromShape=function(u){var w=u.style(false);var v=u.renderer("svgGroup");var t=u.position(false);n(w.shape).update(this.svg,v,u,t,w)};f.prototype.makeSvgEdgeInteractive=function(x){var u=x.renderer("svg");var y=x.renderer("svgTargetArrow");var w=x.renderer("svgSourceArrow");var v=i(u).parents("svg:first")[0];var t=this;i(u).add(y).add(w).bind("mouseup mousedown click touchstart touchmove touchend mouseover mousemove mouseout",function(z){if(t.edgeEventIsValid(x,z)){x.trigger(z)
}}).bind("click touchend",function(z){t.selectElement(x)})};f.prototype.makeSvgNodeLabelInteractive=function(t){};f.prototype.makeSvgNodeInteractive=function(w){var u=w.renderer("svg");var v=i(u).parents("svg:first")[0];var t=this;var x=null;i(u).bind("mousedown touchstart",function(z){x=false;w.trigger(z);if(w.grabbed()||w.locked()||!w.grabbable()){z.preventDefault();return}if(z.type=="touchstart"&&z.originalEvent.touches.length>1){return}w._private.grabbed=true;w.trigger(i.extend({},z,{type:"grab"}));
t.touchingNodes=t.touchingNodes.add(w);var H,F;if(z.type=="touchstart"){var C=z.originalEvent.touches;var B=C[C.length-1];H=B.pageX;F=B.pageY}else{H=z.pageX;F=z.pageY}var G=true;var D=function(L){x=true;var O,N;if(L.type=="touchmove"){var M=z.originalEvent.touches;var P=M[M.length-1];O=P.pageX;N=P.pageY}else{O=L.pageX;N=L.pageY}var J=(O-H)/t.zoom();var I=(N-F)/t.zoom();H=O;F=N;var K;if(w.selected()){K=t.selectedElements.add(w)}else{K=w.collection()}K.each(function(Q,R){R.element()._private.position.x+=J;
R.element()._private.position.y+=I});t.updatePosition(K);if(G){if(L.type!="touchmove"){t.moveToFront(w)}G=false}else{w.trigger(i.extend({},L,{type:"position"}));w.trigger(i.extend({},L,{type:"drag"}))}};i(window).bind("mousemove touchmove",D);var A=false;var y=0;var E=function(I){if(I.type=="touchend"&&I.originalEvent.touches.length!=0){return}if(!A){A=true}else{return}i(window).unbind("mousemove touchmove",D);i(window).unbind("mouseup touchend blur",E);i(u).unbind("mouseup touchend",E);w._private.grabbed=false;
t.touchingNodes=t.touchingNodes.not(w);w.trigger(i.extend({},I,{type:"free"}))};i(window).bind("mouseup touchend blur",E);i(u).bind("mouseup touchend",E);z.preventDefault()}).bind("mouseup touchend",function(y){w.trigger(i.extend({},y));if(x==false){x=null;w.trigger(i.extend({},y,{type:"click"}));t.selectElement(w)}}).bind("mouseover mouseout mousemove",function(y){if(t.nodeEventIsValid(w,y)){w.trigger(i.extend({},y))}})};f.prototype.edgeEventIsValid=function(v,w){var t=i(w.relatedTarget);var u=this;
switch(w.type){case"mouseover":case"mouseout":return t.parent().parent().size()>0;default:return true}};f.prototype.nodeEventIsValid=function(v,w){var t=i(w.relatedTarget);var u=this;switch(w.type){case"mouseover":case"mouseout":return t.parent().parent().size()>0;default:return true}};f.prototype.modelPoint=function(v){var u=this;var t={};if(v.x!==undefined){t.x=(v.x-u.pan().x)/u.zoom()}if(v.y!==undefined){t.y=(v.y-u.pan().y)/u.zoom()}return t};f.prototype.renderedPoint=function(u){var t=this;var v={};
if(u.x!==undefined){v.x=u.x*t.zoom()+t.pan().x}if(u.y!==undefined){v.y=u.y*t.zoom()+t.pan().y}return v};f.prototype.renderedPosition=function(u){var t=this;return t.renderedPoint(u.position(false))};f.prototype.hideElements=function(t){t.each(function(v,u){u.bypass(false).visibility="hidden"});this.updateBypass(t)};f.prototype.showElements=function(v){var u=this;var t=this.cy.collection();v.each(function(x,w){w.bypass(false).visibility="visible"});this.updateBypass(v)};f.prototype.elementIsVisible=function(t){return t.style(false).visibility!="hidden"
};f.prototype.renderedDimensions=function(u){var t=this;if(u.isNode()){return{height:u.style("height")*t.zoom(),width:u.style("width")*t.zoom()}}else{return{width:u.style("width")*t.zoom()}}};f.prototype.unselectElements=function(t){t=t.collection();t.unselect();this.selectedElements=this.selectedElements.not(t)};f.prototype.selectElementsFromIntersection=function(w,y){var u=this;var v=this.cy.collection();var t=this.cy.collection();function x(E){if(!u.elementIsVisible(E)){return false}var H=n(E.style("shape")).intersectionShape;
var L=u.modelPoint({x:y.x1,y:y.y1});var I=u.modelPoint({x:y.x2,y:y.y2});var C=u.svg.rect(L.x,L.y,I.x-L.x,I.y-L.y);var A=Intersection.intersectShapes(new Rectangle(C),new H(E.renderer("svg")));u.svgRemove(C);var P=u.zoom();var N=E.renderedPosition().x;var K=E.renderedPosition().y;var O=E.renderedDimensions().width+E.style("borderWidth")*P;var F=E.renderedDimensions().height+E.style("borderWidth")*P;var B=y.x1;var M=y.y1;var z=y.x2;var J=y.y2;var D=B<=N&&N<=z&&M<=K&&K<=J;var G=A.points.length>0;return D||G
}this.cy.elements().each(function(A,z){if(z.isNode()){if(x(z)){v=v.add(z)}}else{if(u.elementIsVisible(z)&&x(z.source())&&x(z.target())){v=v.add(z)}}});if(!u.shiftDown){t=t.add(this.cy.elements().filter(function(z,A){return A.selected()&&!v.allSame(A)}))}t.unselect();v.select();u.selectedElements=u.selectedElements.not(t);u.selectedElements=u.selectedElements.add(v)};f.prototype.selectElement=function(v){var u=this;var t=u.cy.collection();var w=u.cy.collection();if(!u.shiftDown){t=t.add(u.cy.elements().filter(function(x,y){return y.selected()&&!v.same(y)
}))}if(u.shiftDown){if(v.selected()){t=t.add(v)}else{w=w.add(v)}}else{if(!v.selected()){w=w.add(v)}}t.unselect();w.select();u.selectedElements=u.selectedElements.not(t);u.selectedElements=u.selectedElements.add(w);u.moveToFront(w)};f.prototype.moveToFront=function(u){u=u.collection();var t=this;u.each(function(w,v){t.svgRemove(v.renderer("svgGroup"));t.makeSvgElement(v);t.updatePosition(u.closedNeighborhood().edges())})};f.prototype.unselectAll=function(){this.unselectElements(this.cy.elements())
};f.prototype.makeSvgNode=function(v){var x=v.position(false);var t=this;if(x.x==null||x.y==null){l.console.debug("SVG renderer is ignoring creating of node `%s` with position (%o, %o)",v.id(),x.x,x.y);return}var u;var w=this.calculateStyle(v);var y=this.svg.group(this.nodesGroup);v.renderer("svgGroup",y);u=n(w.shape).svg(this.svg,y,v,x,w);v.renderer("svg",u);this.makeSvgNodeLabel(v);v.renderer("svg",u);l.console.debug("SVG renderer made node `%s` with position (%i, %i)",v.id(),x.x,x.y);this.makeSvgNodeInteractive(v);
this.updateElementStyle(v,w);return u};f.prototype.makeSvgNodeLabel=function(v){var u=this;var t=v.position("x");var w=v.position("y");v.renderer().svgLabelGroup=u.svg.group(v.renderer().svgGroup);v.renderer().svgLabelOutline=u.svg.text(v.renderer().svgLabelGroup,t,w,"label init");v.renderer().svgLabel=u.svg.text(v.renderer().svgLabelGroup,t,w,"label init")};f.prototype.positionSvgNodeLabel=function(v){var u=this;var t=v.position("x");var w=v.position("y");u.svg.change(v.renderer().svgLabel,{x:t,y:w});
u.svg.change(v.renderer().svgLabelOutline,{x:t,y:w})};f.prototype.makeSvgEdgePath=function(J){var F=this;var ah=J.target();var P=J.source();var y=ah.data("id")==P.data("id");var ac;var L=P.position("x");var au=P.position("y");var K=ah.position("x");var at=ah.position("y");if(L==K&&au==at){K++;at++}var I=J.parallelEdges();var C=I.size();var Z;var B;var ab=20;var ai=20;var V,S,R;var Y=F.getDistance({x:L,y:au},{x:K,y:at});var ak=200;if(!y&&E){ab=Math.min(20+4000/Y,ak)}I.each(function(av,aw){if(aw==J){Z=av
}});function u(){var av=B!=0;var aw=F.svg.createPath();if(ac!=null){F.svgRemove(ac)}if(y){ac=F.svg.path(J.renderer("svgGroup"),aw.move(L,au).curveC(S.x,S.y,R.x,R.y,K,at))}else{if(av){ac=F.svg.path(J.renderer("svgGroup"),aw.move(L,au).curveQ(V.x,V.y,K,at))}else{ac=F.svg.path(J.renderer("svgGroup"),aw.move(L,au).line(K,at))}}}if(y){var N=P.style("height");var H=P.style("width");ab+=Math.max(H,N);B=Z;ab+=ai*(B);var ao=ab;S={x:L,y:au-N/2-ao};R={x:L-H/2-ao,y:au};u()}else{var ad=C%2==0;if(ad){B=Z-C/2+(Z<C/2?0:1);
if(B>0){B-=0.5}else{B+=0.5}}else{B=Z-Math.floor(C/2)}var E=B!=0;if(P.id()>ah.id()){B*=-1}if(E){V=S=R=F.getOrthogonalPoint({x:L,y:au},{x:K,y:at},ab*B)}else{V=S={x:K,y:at};R={x:L,y:au}}u()}var t=F.calculateStyleField(J,"width");var ae=F.calculateStyleField(ah,"shape");var W=F.calculateStyleField(P,"shape");var v=F.calculateStyleField(J,"targetArrowShape");var aq=F.calculateStyleField(J,"sourceArrowShape");var am=3;var z=10;while(am*t<z){am++}var ap=am;var w=ap*t;var ae=n(ae).intersectionShape;var W=n(W).intersectionShape;
var x=Intersection.intersectShapes(new Path(ac),new ae(ah.renderer("svg")));var af=x.points[x.points.length-1];x=Intersection.intersectShapes(new Path(ac),new W(P.renderer("svg")));var G=x.points[0];var aa=ap*t;var D=-1*(this.getAngle(S,{x:L,y:au})-90);var U=-1*(this.getAngle(R,{x:K,y:at})-90);if(af!=null){if(v!="none"){var M=F.getPointAlong(af,R,w/2,af);K=M.x;at=M.y}else{if(af!=null){K=af.x;at=af.y}}}if(G!=null){if(aq!="none"){var T=F.getPointAlong(G,S,w/2,G);L=T.x;au=T.y}else{L=G.x;au=G.y}}u();
if(J.renderer("svgTargetArrow")!=null){this.svgRemove(J.renderer("svgTargetArrow"))}if(v!="none"){var al=j(v);var X={x:K-al.centerPoint.x*aa,y:at-al.centerPoint.y*aa,};var A=al.centerPoint;var an=al==null?null:al.svg(this.svg,J.renderer("svgGroup"),J,J.position(false),J.style(false));J.renderer("svgTargetArrow",an);this.svg.change(an,{transform:"translate("+X.x+" "+X.y+") scale("+aa+") rotate("+U+" "+A.x+" "+A.y+")"})}if(J.renderer("svgSourceArrow")!=null){this.svgRemove(J.renderer("svgSourceArrow"))
}if(aq!="none"){var Q=j(aq);var O={x:L-Q.centerPoint.x*aa,y:au-Q.centerPoint.y*aa,};var aj=Q.centerPoint;var ag=Q==null?null:Q.svg(this.svg,J.renderer("svgGroup"),J,J.position(false),J.style(false));J.renderer().svgSourceArrow=ag;this.svg.change(ag,{transform:"translate("+O.x+" "+O.y+") scale("+aa+") rotate("+D+" "+aj.x+" "+aj.y+")"})}var ar;if(y){ar={x:(S.x+R.x)/2*0.85+ah.position("x")*0.15,y:(S.y+R.y)/2*0.85+ah.position("y")*0.15}}else{if(E){ar={x:(V.x+(L+K)/2)/2,y:(V.y+(au+at)/2)/2}}else{ar={x:(L+K)/2,y:(au+at)/2}
}}J.renderer("svgLabelGroup",F.svg.group(J.renderer().svgGroup));J.renderer("svgLabelOutline",F.svg.text(J.renderer().svgLabelGroup,ar.x,ar.y,"label init"));J.renderer("svgLabel",F.svg.text(J.renderer().svgLabelGroup,ar.x,ar.y,"label init"));J.renderer().svg=ac;return ac};f.prototype.markerDrawFix=function(){this.forceRedraw()};f.prototype.forceRedraw=function(){this.svg.change(this.svgRoot,{opacity:0});this.svg.change(this.svgRoot,{opacity:Math.random()});this.svg.change(this.svgRoot,{opacity:1});
var t=this.svg.rect(0,0,this.cy.container().width(),this.cy.container().height());this.svgRemove(t)};f.prototype.getAngle=function(z,y){var u=function(A){return A*180/Math.PI};var x=this.getDistance(z,y);var w=y.x-z.x;var t=-1*(y.y-z.y);var v=u(Math.acos(w/x));if(t<0){return 360-v}else{return v}};f.prototype.getOrthogonalPoint=function(y,x,u){var w={x:y.x-x.x,y:y.y-x.y};var v=this.getNormalizedPoint({x:w.y,y:-w.x},1);var t={x:(y.x+x.x)/2,y:(y.y+x.y)/2};return{x:t.x+v.x*u,y:t.y+v.y*u}};f.prototype.getPointAlong=function(x,w,v,y){var t={x:w.x-x.x,y:w.y-x.y};
var u=this.getNormalizedPoint({x:t.x,y:t.y},1);if(y==null){y=w}return{x:y.x+u.x*v,y:y.y+u.y*v}};f.prototype.getNormalizedPoint=function(w,v){var u=Math.sqrt(w.x*w.x+w.y*w.y);var t=v/u;return{x:w.x*t,y:w.y*t}};f.prototype.getDistance=function(u,t){return Math.sqrt((t.x-u.x)*(t.x-u.x)+(t.y-u.y)*(t.y-u.y))};f.prototype.makeSvgEdge=function(u){var t=this;var w=u.source().element();var y=u.target().element();if(w==null||y==null){l.console.debug("SVG renderer is ignoring creating of edge `%s` with missing nodes");
return}var A=w.position(false);var x=y.position(false);if(A.x==null||A.y==null||x.x==null||x.y==null){l.console.debug("SVG renderer is ignoring creating of edge `%s` with position (%o, %o, %o, %o)",u.id(),A.x,A.y,x.x,x.y);return}var v=this.calculateStyle(u);var z=this.svg.group(this.edgesGroup);u.renderer().svgGroup=z;this.svg.change(z);this.makeSvgEdgePath(u);l.console.debug("SVG renderer made edge `%s` with position (%i, %i, %i, %i)",u.id(),A.x,A.y,x.x,x.y);this.makeSvgEdgeInteractive(u);this.updateElementStyle(u,v);
return u.renderer().svg};f.prototype.makeSvgElement=function(u){var t;if(u.group()=="nodes"){t=this.makeSvgNode(u)}else{if(u.group()=="edges"){t=this.makeSvgEdge(u)}}return t};f.prototype.getSvgElement=function(t){if(t.renderer().svg!=null){return t.renderer().svg}else{return this.makeSvgElement(t)}};f.prototype.updateSelection=function(t){this.updateElementsStyle(t)};f.prototype.updateClass=function(t){this.updateElementsStyle(t)};f.prototype.updateData=function(u,t){this.updateElementsStyle(u);
if(t){this.updateMapperBounds(u)}};f.prototype.updateMapperBounds=function(u){var t=this.cy.elements();if(u.nodes().size()>0&&u.edges().size()>0){}else{t=t.filter(function(){return this.group()==u.eq(0).group()})}t=t.not(u);this.updateElementsStyle(t)};f.prototype.updateElementsStyle=function(u){var t=this;u=u.collection();u.nodes().each(function(w,v){t.updateElementStyle(v)});u.edges().each(function(w,v){t.updateElementStyle(v)});u.nodes().neighborhood().edges().not(u.edges()).each(function(w,v){t.updatePosition(v)
})};f.prototype.setStyle=function(t){this.style=i.extend(true,{},k.style,t)};f.prototype.updateStyle=function(t){var u=this.cy.elements();this.setStyle(t);this.updateElementsStyle(u)};f.prototype.updateBypass=function(u){var t=this;u=u.collection();u.nodes().each(function(w,v){t.updateElementStyle(v)});u.edges().add(u.closedNeighborhood().edges()).each(function(v,w){t.updateElementStyle(w)})};f.prototype.updateElementStyle=function(t,u){if(t.isNode()){this.updateNodeStyle(t,u)}else{if(t.isEdge()){this.updateEdgeStyle(t,u)
}}};f.prototype.updateNodeStyle=function(w,v){var A=w.style(false).shape;w._private.style=v!=null?v:this.calculateStyle(w);var t=w.style(false);var B=w.style(false).shape;if(w.renderer().svg==null){l.console.error("SVG renderer can not update style for node `%s` since it has no SVG element",w.id());return}if(B!=A){this.svgRemove(w.renderer().svgGroup);this.makeSvgNode(w);return}this.svg.change(w.renderer().svg,{"pointer-events":"visible",fill:p(t.fillColor),fillOpacity:b(t.fillOpacity),stroke:p(t.borderColor),strokeWidth:c(t.borderWidth),strokeDashArray:e(t.borderStyle).array,strokeOpacity:b(t.borderOpacity),cursor:h(t.cursor),visibility:q(t.visibility)});
this.svg.change(w.renderer().svgGroup,{opacity:b(t.opacity)});var x={visibility:q(t.visibility),"pointer-events":"none",fill:p(t.labelFillColor),"font-family":t.labelFontFamily,"font-weight":t.labelFontWeight,"font-style":t.labelFontStyle,"text-decoration":t.labelFontDecoration,"font-variant":t.labelFontVariant,"font-size":t.labelFontSize};this.svg.change(w.renderer().svgLabelGroup,{opacity:b(t.labelOpacity)});this.svg.change(w.renderer().svgLabelOutline,{stroke:p(t.labelOutlineColor),strokeWidth:c(t.labelOutlineWidth)*2,fill:"none",opacity:b(t.labelOutlineOpacity)});
this.svg.change(w.renderer().svgLabelOutline,x);this.svg.change(w.renderer().svgLabel,x);var u=t.labelText==null?"":t.labelText;w.renderer().svgLabel.textContent=u;w.renderer().svgLabelOutline.textContent=u;var z=g(t.labelValign);var y=r(t.labelHalign);this.svg.change(w.renderer().svgGroup,{fillOpacity:b(t.fillOpacity)});n(t.shape).update(this.svg,this.nodesGroup,w,w.position(false),t);this.updateLabelPosition(w,z,y);l.console.debug("SVG renderer collapsed mappers and updated style for node `%s` to %o",w.id(),t)
};f.prototype.updateLabelPosition=function(w,B,y){var z=3;var H=0;var E=0;var D=0;var t=0;var C=w.renderer().svgLabel.textContent;this.positionSvgNodeLabel(w);var v;var A;var u;if(C==null||C==""){return}if(w.isNode()){D=w.style(false).height;t=w.style(false).width}if(y=="middle"){v={"text-anchor":"middle"}}else{if(y=="right"){v={"text-anchor":"start"};H=t/2+z}else{if(y=="left"){v={"text-anchor":"end"};H=-t/2-z}}}var G=parseInt(window.getComputedStyle(w.renderer().svgLabel)["fontSize"]);var F=i.browser.msie?G/3:0;
if(B=="middle"){A={style:"alignment-baseline: central; dominant-baseline: central;"};E=0+F}else{if(B=="top"){A={style:"alignment-baseline: normal; dominant-baseline: normal;"};E=-D/2-z}else{if(B=="bottom"){A={style:"alignment-baseline: normal; dominant-baseline: normal;"};E=D/2+G}}}u={transform:"translate("+H+","+E+")"};var x=i.extend({},v,A,u);this.svg.change(w.renderer().svgLabelOutline,x);this.svg.change(w.renderer().svgLabel,x)};f.prototype.updateEdgeStyle=function(z,w){var F=z.style(false).targetArrowShape;
var x=z.style(false).sourceArrowShape;z._private.style=w!=null?w:this.calculateStyle(z);var t=z.style(false);if(z.renderer().svg==null){l.console.error("SVG renderer can not update style for edge `%s` since it has no SVG element",z.id());return}var y=z.source().style();var D=z.renderer().oldSourceStyle||y;var v=z.target().style();var G=z.renderer().oldTargetStyle||v;var H=z.style(false).targetArrowShape;var B=z.style(false).sourceArrowShape;var E=y.height!=D.height||y.width!=D.width||v.height!=G.height||v.width!=G.width||y.shape!=D.shape||v.shape!=G.shape||y.borderWidth!=D.borderWidth||v.borderWidth!=G.borderWidth;
var C=z.renderer().oldStyle==null||z.renderer().oldStyle.width!=t.width;z.renderer().oldSourceStyle=y;z.renderer().oldTargetStyle=v;z.renderer().oldStyle=t;if(H!=F||B!=x||E||C){this.svgRemove(z.renderer().svgGroup);this.makeSvgEdge(z);return}this.svg.change(z.renderer().svg,{"pointer-events":"visibleStroke",stroke:p(t.lineColor),strokeWidth:c(t.width),strokeDashArray:e(t.style).array,"stroke-linecap":"butt",cursor:h(t.cursor),fill:"none",visibility:q(t.visibility)});this.svg.change(z.renderer().svgGroup,{opacity:b(t.opacity)});
this.svg.change(z.renderer().svgTargetArrow,{fill:p(t.targetArrowColor),cursor:h(t.cursor),visibility:q(t.visibility)});this.svg.change(z.renderer().svgSourceArrow,{fill:p(t.sourceArrowColor),cursor:h(t.cursor),visibility:q(t.visibility)});var A={visibility:q(t.visibility),"pointer-events":"none",fill:p(t.labelFillColor),"font-family":t.labelFontFamily,"font-weight":t.labelFontWeight,"font-style":t.labelFontStyle,"text-decoration":t.labelFontDecoration,"font-variant":t.labelFontVariant,"font-size":t.labelFontSize};
this.svg.change(z.renderer().svgLabel,A);this.svg.change(z.renderer().svgLabelOutline,i.extend({},A,{fill:"none",stroke:p(t.labelOutlineColor),strokeWidth:c(t.labelOutlineWidth)*2,opacity:b(t.labelOutlineOpacity),}));this.svg.change(z.renderer().svgLabelGroup,{opacity:b(t.labelOpacity)});var u=t.labelText==null?"":t.labelText;z.renderer().svgLabel.textContent=u;z.renderer().svgLabelOutline.textContent=u;this.updateLabelPosition(z,"middle","middle");l.console.debug("SVG renderer collapsed mappers and updated style for edge `%s` to %o",z.id(),t)
};f.prototype.addElements=function(v,u){var t=this;var w=this.cy;v.nodes().each(function(y,x){t.makeSvgElement(x)});v.edges().each(function(y,x){t.makeSvgElement(x)});t.positionEdges(v.edges().parallelEdges());if(u){t.updateMapperBounds(v)}};f.prototype.updatePosition=function(w){l.console.debug("SVG renderer is updating node positions");w=w.collection();var t=this.cy.container();var v=t.svg("get");var u=this;var x=this.options.cy;w.nodes().each(function(A,z){var y=u.getSvgElement(z);var B=z.position(false);
u.updateNodePositionFromShape(z);u.positionSvgNodeLabel(z);l.console.debug("SVG renderer is moving node `%s` to position (%o, %o)",z.id(),B.x,B.y)});u.positionEdges(w.closedNeighborhood().edges())};f.prototype.positionEdges=function(u){var t=this;u.each(function(v,w){if(w.renderer().svgGroup!=null){t.svgRemove(w.renderer().svgGroup)}t.makeSvgEdge(w);var y=w.source().position(false);var x=w.target().position(false);l.console.debug("SVG renderer is moving edge `%s` to position (%o, %o, %o, %o)",w.id(),y.x,y.y,x.x,x.y)
})};f.prototype.drawElements=function(u){var t=this;t.updateElementsStyle(u)};f.prototype.removeElements=function(x,w){l.console.debug("SVG renderer is removing elements");var t=this.cy.container();var v=t.svg("get");var y=this.options.cy;var u=this;x.each(function(A,z){if(z.renderer().svgGroup!=null){v.remove(z.renderer().svgGroup);z.removeRenderer("svg");z.removeRenderer("svgGroup");z.removeRenderer("svgSourceArrow");z.removeRenderer("svgTargetArrow")}else{l.console.debug("Element with group `%s` and ID `%s` has no associated SVG element",z.group(),z.id())
}});if(u.selectedElements!=null){u.selectedElements=u.selectedElements.not(x)}if(w){this.updateMapperBounds(x)}};f.prototype.notify=function(v){var t=this.options.cy.container();l.console.debug("Notify SVG renderer with params (%o)",v);if(v.type==null){l.console.error("The SVG renderer should be notified with a `type` field");return}var u=this;switch(v.type){case"load":u.init(function(){u.addElements(v.collection)});break;case"add":this.addElements(v.collection,v.updateMappers);break;case"remove":this.removeElements(v.collection,v.updateMappers);
break;case"position":this.updatePosition(v.collection);break;case"style":this.updateStyle(v.style);break;case"bypass":this.updateBypass(v.collection);break;case"class":this.updateClass(v.collection);break;case"data":this.updateData(v.collection,v.updateMappers);break;case"select":case"unselect":this.updateSelection(v.collection);break;case"draw":this.drawElements(v.collection);break;default:l.console.debug("The SVG renderer doesn't consider the `%s` event",v.type);break}};function a(t){this.options=t;
this.cy=t.cy;this.renderer=t.renderer;if(this.renderer.name()!="svg"){l.console.error("The SVG exporter can be used only if the SVG renderer is used")}}a.prototype.run=function(){return this.options.cy.container().svg("get").toSVG()};i.cytoscapeweb("renderer","svg",f);i.cytoscapeweb("exporter","svg",a)})(jQuery,jQuery.cytoscapeweb);