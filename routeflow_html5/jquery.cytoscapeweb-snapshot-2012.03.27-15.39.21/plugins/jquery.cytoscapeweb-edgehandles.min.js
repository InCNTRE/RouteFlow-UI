
/* jquery.cytoscapeweb-edgehandles.min.js */

/**
 * This file is part of Cytoscape Web snapshot-2012.03.27-15.39.21.
 * 
 * Cytoscape Web is free software: you can redistribute it and/or modify it
 * under the terms of the GNU Lesser General Public License as published by the Free
 * Software Foundation, either version 3 of the License, or (at your option) any
 * later version.
 * 
 * Cytoscape Web is distributed in the hope that it will be useful, but WITHOUT
 * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS
 * FOR A PARTICULAR PURPOSE. See the GNU Lesser General Public License for more
 * details.
 * 
 * You should have received a copy of the GNU Lesser General Public License along with
 * Cytoscape Web. If not, see <http://www.gnu.org/licenses/>.
 */
 
(function(a){var b={handleSize:10,handleColor:"red",handleLineWidth:1,lineType:"draw",edgeType:function(c,d){return"node"},loopAllowed:function(c){return false},nodeParams:function(c,d){return{}},edgeParams:function(c,d){return{}}};a.fn.cytoscapewebEdgehandles=function(e){var c=e;var d={destroy:function(){var g=a(this);var f=g.data("cyedgehandles");if(f==null){return}f.unbind();g.data("cyedgehandles",{});return g},option:function(g,j){var k=a(this);var i=k.data("cyedgehandles");if(i==null){return
}var f=i.options;if(j===undefined){if(typeof g==typeof{}){var h=g;f=a.extend(true,{},b,h);i.options=f}else{return f[g]}}else{f[g]=j}return k},init:function(){var j=a.extend(true,{},b,e);var p=a(this);var o,g;var t;var n,l;var f=false;var x=false;var s,r,v;var w=p.data("cyedgehandles");if(w==null){w={}}w.options=j;function k(z){var A=a(z);var y=false;A.parents().each(function(){if(this==p[0]){y=true}});return y}function u(y){if(y!=null&&k(y)){o.remove(y)}}function m(){u(t);u(n);g.nodes().removeClass("ui-cytoscapeweb-edgehandles-hover").removeClass("ui-cytoscapeweb-edgehandles-source").removeClass("ui-cytoscapeweb-edgehandles-target");
l=null;g.zooming(true).panning(true)}function h(y,z){i(true)}function q(y,z){y.edgesWith(z).filter(".ui-cytoscapeweb-edgehandles-preview").remove();z.neighborhood("node.ui-cytoscapeweb-edgehandles-preview").closedNeighborhood(".ui-cytoscapeweb-edgehandles-preview").remove()}function i(B){var A=g.nodes(".ui-cytoscapeweb-edgehandles-source");var y=g.nodes(".ui-cytoscapeweb-edgehandles-target");var z=B?"ui-cytoscapeweb-edgehandles-preview":"";if(A.size()==0||y.size()==0){return}if(!B&&j.preview){g.elements(".ui-cytoscapeweb-edgehandles-preview").removeClass("ui-cytoscapeweb-edgehandles-preview");
return}else{g.elements(".ui-cytoscapeweb-edgehandles-preview").remove()}y.each(function(D,G){switch(j.edgeType(A,G)){case"node":var H=A.position(false);var F=G.position(false);var E={x:(H.x+F.x)/2,y:(H.y+F.y)/2};var C=g.add(a.extend(true,{group:"nodes",position:E},j.nodeParams(A,G))).addClass(z);g.add(a.extend(true,{group:"edges",data:{source:A.id(),target:C.id()}},j.edgeParams(A,G))).addClass(z);g.add(a.extend(true,{group:"edges",data:{source:C.id(),target:G.id()}},j.edgeParams(A,G))).addClass(z);
break;case"flat":default:g.add(a.extend(true,{group:"edges",data:{source:A.id(),target:G.id()}},j.edgeParams(A,G))).addClass(z);break}})}p.cytoscapeweb(function(C){g=this;o=p.svg("get");var E;g.bind("zoom pan",E=function(){u(t)});var A,y,z,D,B;g.nodes().live("mouseover",A=function(M){if(f||x||this.hasClass("ui-cytoscapeweb-edgehandles-preview")){return}var J=this;var F=this;var I=J.renderedPosition();var N=J.renderedDimensions();u(t);s=I.x;r=I.y-N.height/2;v=j.handleSize/2;t=o.circle(s,r,v,{fill:j.handleColor});
var H=a(t);function G(P){if(P.button!=0){return}f=true;P.preventDefault();J.unbind("mouseout",K);H.unbind("mouseout",K);J.addClass("ui-cytoscapeweb-edgehandles-source");function O(){var Q=a(this);f=false;a(window).unbind("mousemove",L);i();m()}a(window).one("mouseup blur",O).bind("mousemove",L);g.zooming(false).panning(false)}function L(Q){var O=Q.pageX-p.offset().left;var R=Q.pageY-p.offset().top;u(n);var P={stroke:j.handleColor,strokeWidth:j.handleLineWidth,fill:"none","pointer-events":"none"};
switch(j.lineType){case"straight":n=o.line(s,r,O,R,P);break;case"draw":default:if(l==null){l=[[s,r],[O,R]]}else{l.push([O,R])}n=o.polyline(l,P);break}}function K(Q){var P=Q.toElement==t;var O=Q.toElement==J._private.renderer.svg;if(P||O){return}m();J.unbind("mouseout",K)}J.bind("mouseout",K);H.bind("mouseout",K);H.bind("mousedown",G)}).live("mouseover",y=function(){if(this.hasClass("ui-cytoscapeweb-edgehandles-preview")){return}if(f){var G=this;var I=this;var H=g.nodes(".ui-cytoscapeweb-edgehandles-source");
var F=G.hasClass("ui-cytoscapeweb-edgehandles-source");var J=j.loopAllowed(G);if(!F||(F&&J)){this.addClass("ui-cytoscapeweb-edgehandles-hover");this.toggleClass("ui-cytoscapeweb-edgehandles-target");if(j.preview){if(this.hasClass("ui-cytoscapeweb-edgehandles-target")){h(H,I)}else{q(H,I)}}}}}).live("mouseout",z=function(){this.removeClass("ui-cytoscapeweb-edgehandles-hover")}).live("grab",D=function(){x=true;m()}).live("free",B=function(){x=false});w.unbind=function(){g.nodes().die("mouseover",A).die("mouseover",y).die("mouseout",z).die("grab",D).die("free",B);
g.unbind("zoom pan",E)}});p.data("cyedgehandles",w)}};if(d[c]){return d[c].apply(this,Array.prototype.slice.call(arguments,1))}else{if(typeof c=="object"||!c){return d.init.apply(this,arguments)}else{a.error("No such function `"+c+"` for jquery.cytoscapewebEdgeHandles")}}return a(this)}})(jQuery);